#!/bin/bash
#
#
#
#
#
#Blah first run, about, menu.
#
## Load libkeyrng
. libkeyrng
## Check if it is the first run.
FIRST_RUN=$(ls gpg-KeyRNG | grep -c "secring")
  if [ "$FIRST_RUN" -lt "1" ]; then
      clear
      firstrun
  fi
## What now?
clear
echo "---------------------"
echo "| M A I N   M E N U |"
echo "---------------------"
PS3='Enter your choice (press enter to see options again): '
options=("Key Management" "Encryption" "Quit")
select a in "${options[@]}"
do
    case "$a" in
        "Key Management")
            PS3='Enter your choice (press enter to see options again): '
            options=("Generate New Keypair" "Public Key(s)" "Quit")
            select b in "${options[@]}"
            do
                case "$b" in
                    "Generate New Keypair")
                        genkey
                        ;;
                    "Public Key(s)")
                        PS3='Enter your choice (press enter to see options again): '
                        options=("List Public Keys By UID" "List Full Public Keys" "Import Key" "Export A Public Key To Terminal" "Export A Public Key To File" "Send Keys To Keyserver" "Receive Keys From Keyserver" "Quit")
                        select c in "${options[@]}"
                        do
                            case "$c" in
                                "List Public Keys By UID")
                                    listkeyuids
                                    ;;
                                "List Full Public Keys")
                                    listfullkeydetails
                                    ;;
                                "Import Key")
                                    sleep 1
                                    ;;
                                "Export A Public Key To Terminal")
                                    exportpubkey
                                    ;;
                                "Export A Public Key To File")
                                    exportpubkeyfile
                                    ;;
                                "Send Keys To Keyserver")
                                    sendkeyserv
                                    ;;
                                "Receive Keys From Keyserver")
                                    recvkeyserv
                                    ;;
                                "Quit")
                                    echo "Press enter to return to Key Management menu."
                                    read
                                    break
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done
#                   "See/Export Secret Keys")
                        exportseckeyfile
                        ;;
                    "Quit")
                        echo "Press enter to return to main menu."
                        read
                        break
                        ;;
                    *) echo "Invalid option";;
                esac
            done
            ;;
        "Encryption")
            encryptfile
            ;;
        "Quit")
            break
            ;;
        *) echo "Invalid option";;
    esac
done
