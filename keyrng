#!/bin/bash
#
#
#
#
#
#Blah first run, about, menu.
#
#
## IS LOCKED
IS_LOCKED=$(ls | grep -c ".tar.gz.gpg")
if [ "$IS_LOCKED" -gt "0" ]; then
    clear
    echo "---------------------------------------"
    echo "| L O C K E D   K e y R N G   M E N U |"
    echo "---------------------------------------"
    PS3='Enter choice (press enter to see options again): '
    options=("Unlock KeyRNG Files" "Copy Encrypted Files For Backup" "About Locked File" "Quit")
    select opt in "${options[@]}"
    do
        case "$opt" in
            "Unlock KeyRNG Files")
unlock ()
{
gpg2 -d *.tar.gz.gpg > lock.KeyRNG.tar.gz
tar -xf lock.KeyRNG.tar.gz
chown -R "$USER" * */ */*
chmod 0600 gpg-KeyRNG/gpg.conf
echo "Shredding temp files..."
HAS_SRM=$(ls /usr/bin/ /usr/sbin/ /usr/local/bin/ /home/"$USER"/bin/ | grep -c srm)
if [[ "$HAS_SRM" -gt "0" ]]; then
    srm -drlv *.tar.gz*
else
    shred -vuzn 3 *.tar.gz*
fi
}
                unlock
                . libkeyrng
                break
                ;;
            "Copy Encrypted Files For Backup")
                clear
                echo "What would you like to name the backup copy?"
                read BACKUP
                echo "Copying..."
                cp *.tar.gz.gpg "$BACKUP".tar.gz.gpg
                echo "File is at "$BACKUP".tar.gz.gpg"
                echo "You should move it somewhere else if you would like to keep it."
                echo "Press enter to exit."
                read
                exit 0
                ;;
            "About Locked File")
                clear
                ls -lh *.tar.gz.gpg
                ;;
            "Quit")
                exit 0
                ;;
        esac
    done
fi
## TEMP FILE
HAS_TEMP_FILE=$(ls | grep -c "temp")
if [ "$HAS_TEMP_FILE" -lt "1" ]; then
    mkdir temp/
fi
## LOAD LIBRARY
. libkeyrng
## MAIN MENU 
clear
echo "---------------------"
echo "| M A I N   M E N U |"
echo "---------------------"
PS3='Enter choice (press enter to see options again): '
options=("GnuPG Management" "Bitcoin Management" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
select opt in "${options[@]}"
do
    case "$opt" in
        "GnuPG Management")
        IS_FIRST_RUN=$(ls gpg-KeyRNG | grep -c "secring")
        if [ "$IS_FIRST_RUN" -lt "1" ]; then
            clear
            echo "---------------------"
            echo "| F I R S T   R U N |"
            echo "---------------------"
            echo "This is your first run."
            echo "You must create a gpg key to begin with."
            echo "Press enter to move on."
            read
            clear
            firstrun
        fi
        clear
        echo "------------"
        echo "| GPG MENU |"
        echo "------------"
        PS3='Enter choice (press enter to see options again): '
        options=("Key Management" "Encryption" "Decryption" "Clearsign" "Back To MAIN MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
        select opt in "${options[@]}"
        do
            case "$opt" in
                "Key Management")
                    clear
                    echo "-------------------------------"
                    echo "| K E Y   M A N A G E M E N T |"
                    echo "-------------------------------"
                    PS3='Enter choice (press enter to see options again): '
                    options=("Generate New Keypair" "Public Keys" "Secret Keys" "Back To GPG MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                    select opt in "${options[@]}"
                    do
                        case "$opt" in
                            "Generate New Keypair")
                                genkey
                                ;;
                            "Public Keys")
                                clear
                                echo "-------------------------"
                                echo "| P U B L I C   K E Y S |"
                                echo "-------------------------"
                                PS3='Enter choice (press enter to see options again): '
                                options=("List Public Keys By UID" "List Full Public Keys" "Import Keys" "Export A Public Key To Terminal" "Export A Public Key To File" "Send Keys To Keyserver" "Receive Keys From Keyserver" "Back To KEY MANAGEMENT MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                                select opt in "${options[@]}"
                                do
                                    case "$opt" in
                                        "List Public Keys By UID")
                                            listkeyuids
                                            ;;
                                        "List Full Public Keys")
                                            listfullkeydetails
                                            ;;
                                        "Import Keys")
                                            clear
                                            echo "------------------------"
                                            echo "| I M P O R T   K E Y S|"
                                            echo "------------------------"
                                            PS3='Enter choice (press enter to see options again): '
                                            options=("Import Public Key From File" "Import Public Key From Clipboard" "Import Single Key From Another GPG" "Import All Public Keys From Another GPG" "Back To PUBLIC KEYS MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                                            select opt in "${options[@]}"
                                            do
                                                case "$opt" in
                                                    "Import Public Key From File")
                                                        importkeyfile
                                                        ;;
                                                    "Import Public Key From Clipboard")
                                                        importkeyclip
                                                        ;;
                                                    "Import Single Key From Another GPG")
                                                        importkeyfromgpg
                                                        ;;
                                                    "Import All Public Keys From Another GPG")
                                                        gpgimportallpub
                                                        ;;
                                                    "Back To PUBLIC KEYS MENU")
                                                        break
                                                        ;;
                                                    "Quit")
                                                        badquit
                                                        ;;
                                                    "FAST LOCK UP")
                                                        fastlockup
                                                        ;;
                                                    "SECURE LOCK UP")
                                                        lockup
                                                        ;;
                                                    *) echo "Invalid Option";;
                                                esac
                                            done
                                            ;;
                                        "Export A Public Key To Terminal")
                                            exportpubkey
                                            ;;
                                        "Export A Public Key To File")
                                            exportpubkeyfile
                                            ;;
                                        "Send Keys To Keyserver")
                                            sendkeyserv
                                            ;;
                                        "Receive Keys From Keyserver")
                                            recvkeyserv
                                            ;;
                                        "Back To KEY MANAGEMENT MENU")
                                            break
                                            ;;
                                        "Quit")
                                            badquit
                                            ;;
                                        "FAST LOCK UP")
                                            fastlockup
                                            ;;
                                        "SECURE LOCK UP")
                                            lockup
                                            ;;
                                        *) echo "Invalid Option";;
                                    esac
                                done
                                ;;
                            "Secret Keys")
                                clear
                                echo "-------------------------"
                                echo "| S E C R E T   K E Y S |"
                                echo "-------------------------"
                                PS3='Enter choice (press enter to see options again): '
                                options=("Import Secret Key From File" "Import Secret Key From Clipboard" "Import All Secret Keys From Another GPG" "List Secret Keys By UID" "List Full Secret Key Info" "Export Secret Key To Terminal" "Export Secret Key To File" "Back To KEY MANAGEMENT MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                                select opt in "${options[@]}"
                                do
                                    case "$opt" in
                                        "Import Secret Key From File")
                                            importkeyfile
                                            ;;
                                        "Import Secret Key From Clipboard")
                                            importkeyclip
                                            ;;
                                        "Import All Secret Keys From Another GPG")
                                            gpgimportallsec
                                            ;;
                                        "List Secret Keys By UID")
                                            listseckeyuid
                                            ;;
                                        "List Full Secret Key Info")
                                            listfullseckey
                                            ;;
                                        "Export Secret Key To Terminal")
                                            exportseckey
                                            ;;
                                        "Export Secret Key To File")
                                            exportseckeyfile
                                            ;;
                                        "Back To KEY MANAGEMENT MENU")
                                            break
                                            ;;
                                        "Quit")
                                            badquit
                                            ;;
                                        "FAST LOCK UP")
                                            fastlockup
                                            ;;
                                        "SECURE LOCK UP")
                                            lockup
                                            ;;
                                        *) echo "Invalid Option";;
                                        esac
                                    done
                                    ;;
                                "Back To GPG MENU")
                                    break
                                    ;;
                                "Quit")
                                    badquit
                                    ;;
                                "FAST LOCK UP")
                                    fastlockup
                                    ;;
                                "SECURE LOCK UP")
                                    lockup
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done
                        ;;
                    "Encryption")
                        clear
                        echo "---------------------------------"
                        echo "| E N C R Y P T I O N   M E N U |"
                        echo "---------------------------------"
                        PS3='Enter choice (press enter to see options again): '
                        options=("Encrypt A File" "Encrypt A New Message" "Back To GPG MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                        select opt in "${options[@]}"
                        do
                            case "$opt" in
                                "Encrypt A File")
                                    encryptfile
                                    ;;
                                "Encrypt A New Message")
                                    encryptnewmsg
                                    ;;
                                "Back To GPG MENU")
                                    break
                                    ;;
                                "Quit")
                                    badquit
                                    ;;
                                "FAST LOCK UP")
                                    fastlockup
                                    ;;
                                "SECURE LOCK UP")
                                    lockup
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done
                        ;;
                    "Decryption")
                        clear
                        echo "---------------------------------"
                        echo "| D E C R Y P T I O N   M E N U |"
                        echo "---------------------------------"
                        PS3='Enter choice (press enter to see options again): '
                        options=("Decrypt From A File" "Decrypt From Clipboard" "Back To GPG MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                        select opt in "${options[@]}"
                        do
                            case "$opt" in
                                "Decrypt From A File")
                                    decryptfile
                                    ;;
                                "Decrypt From Clipboard")
                                    decryptclip
                                    ;;
                                "Back To GPG MENU")
                                    break
                                    ;;
                                "Quit")
                                    badquit
                                    ;;
                                "FAST LOCK UP")
                                    fastlockup
                                    ;;
                                "SECURE LOCK UP")
                                    lockup
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done
                        ;;
                    "Clearsign")
                        clear
                        echo "-------------------------------"
                        echo "| C L E A R S I G N   M E N U |"
                        echo "-------------------------------"
                        PS3='Enter option (press enter to show options again): '
                        options=("Clearsign From File" "Clearsign New Message" "Verify Clearsigned File" "Verify Clearsigned Message From Clipboard" "Back To GPG MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                        select opt in "${options[@]}"
                        do
                            case "$opt" in
                                "Clearsign From File")
                                    csignfile
                                    ;;
                                "Clearsign New Message")
                                    csignnew
                                    ;;
                                "Verify Clearsigned File")
                                    gpgfileverify
                                    ;;
                                "Verify Clearsigned Message From Clipboard")
                                    gpgclipverify
                                    ;;
                                "Back To GPG MENU")
                                    break
                                    ;;
                                "Quit")
                                    badquit
                                    ;;
                                "FAST LOCK UP")
                                    fastlockup
                                    ;;
                                "SECURE LOCK UP")
                                    lockup
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done
                        ;;
                    "Back To MAIN MENU")
                        break
                        ;;
                    "Quit")
                        badquit
                        ;;
                    "FAST LOCK UP")
                        fastlockup
                        ;;
                    "SECURE LOCK UP")
                        lockup
                        ;;
                    *) echo "Invalid option";;
                esac
            done
            ;;
        "Bitcoin Management")
            HAS_BTCFILE=$(ls | grep -c "btc-KeyRNG")
            if [ "$HAS_BTCFILE" -lt "1" ]; then
                mkdir btc-KeyRNG
                chown "$USER" btc-KeyRNG/
            fi
            ENC_BTCFILE=$(ls | grep -c "btc.tar.gz.gpg")
            if [ "$ENC_BTCFILE" -gt "0" ]; then
                echo "Bitcoin file is locked."
                echo "Press enter to decrypt."
                read
                gpg2 --output btc.tar.gz --decrypt btc.tar.gz.gpg
                tar -x btc.tar.gz
                echo "Shredding old file..."
                DEL=*tar.gz*
                secdelete
            fi
            clear
            echo "---------------------------"
            echo "| B I T C O I N   M E N U |"
            echo "---------------------------"
            PS3='Enter option (press enter to see options again): '
            options=("Standard Addresses" "Electrum Addresses Menu" "BIP32 Seed Addresses" "Sign Message" "Back To MAIN MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
            select opt in "${options[@]}"
            do
                case "$opt" in
                    "Standard Addresses")
                    clear
                    echo "---------------------------------------------"
                    echo "| S T A N D A R D   A D D R E S S   M E N U |"
                    echo "---------------------------------------------"
                    PS3='Enter option (press enter to see options again): '
                    options=("Create New Address" "Show Addresses Only" "Show Addresses And Private Keys" "Back To BITCOIN MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                    select opt in "${options[@]}"
                    do
                        case "$opt" in
                            "Create New Address")
                                getnewaddress
                                ;;
                            "Show Addresses Only")
                                showaddr
                                ;;
                            "Show Addresses And Private Keys")
                                showalladdr
                                ;;
                            "Back To BITCOIN MENU")
                                break
                                ;;
                            "Quit")
                                badquit
                                ;;
                            "FAST LOCK UP")
                                fastlockup
                                ;;
                            "SECURE LOCK UP")
                                lockup
                                ;;
                            *) echo "Invalid Option";;
                        esac
                    done
                    ;;
                    "Electrum Addresses Menu")
                        clear
                        checkeleseed
                        echo "---------------------------------------------"
                        echo "| E L E C T R U M   A D D R E S S   M E N U |"
                        echo "---------------------------------------------"
                        PS3='Enter choice (press enter to see options again): '
                        options=("Create New Address" "Show Addresses Only" "Show Addresses And Private Keys" "Back to BITCOIN MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                        select opt in "${options[@]}"
                        do
                            case "$opt" in
                                "Create New Address")
                                    elecreateaddr
                                    ;;
                                "Show Addresses Only")
                                    eleshowaddr
                                    ;;
                                "Show Addresses And Private Keys")
                                    eleshowall
                                    ;;
                                "Back to BITCOIN MENU")
                                    break
                                    ;;
                                "Quit")
                                    badquit
                                    ;;
                                "FAST LOCK UP")
                                    fastlockup
                                    ;;
                                "SECURE LOCK UP")
                                    lockup
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done                        
                        ;;
                    "BIP32 Seed Addresses")
                        clear
                        checkbipseed
                        echo "---------------------------------------"
                        echo "| B I P 3 2   A D D R E S S   M E N U |"
                        echo "---------------------------------------"
                        PS3='Enter choice (press enter to see options again): '
                        options=("Create New Address" "Show Addresses Only" "Show Addresses And Private Keys" "Back to BITCOIN MENU" "Quit" "FAST LOCK UP" "SECURE LOCK UP")
                        select opt in "${options[@]}"
                        do
                            case "$opt" in
                                "Create New Address")
                                    bipcreateaddr
                                    ;;
                                "Show Addresses Only")
                                    bipshowaddr
                                    ;;
                                "Show Addresses And Private Keys")
                                    bipshowall
                                    ;;
                                "Back to BITCOIN MENU")
                                    break
                                    ;;
                                "Quit")
                                    badquit
                                    ;;
                                "FAST LOCK UP")
                                    fastlockup
                                    ;;
                                "SECURE LOCK UP")
                                    lockup
                                    ;;
                                *) echo "Invalid Option";;
                            esac
                        done                        
                        ;;
                    "Sign Message")
                        ;;
                    "Back To MAIN MENU")
                        break
                        ;;
                    "Quit")
                        badquit
                        ;;
                    "FAST LOCK UP")
                        fastlockup
                        ;;
                    "SECURE LOCK UP")
                        lockup
                        ;;
                    *) echo "Invalid Option";;
                esac
            done
             ;;
        "Quit")
            badquit
            ;;
        "FAST LOCK UP")
            fastlockup
            ;;  
        "SECURE LOCK UP")
            lockup
            ;;
        *) echo "Invalid Option";;
    esac
done

